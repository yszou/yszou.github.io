Racket è¯­è¨€å­¦ä¹ å‚è€ƒ
é‚¹ä¸šç››
%%mtime(%Y-%m-%d %H:%M)
%!encoding: utf-8
%!options(xhtml): --google-analytics --disqus
%!qr: http://www.zouyesheng.com/racket.html
%!format: !email
%%toc


# å®‰è£…ä¸ç®€ä»‹ #

*racket* æ˜¯ä¸€ä¸ªæ¯”è¾ƒç°ä»£åŒ–çš„ *scheme* è¯­è¨€ã€‚å®ƒçš„ Hello World æ˜¯è¿™æ ·çš„ï¼š

```racket
#lang racket  

(display "helloworld")
```

å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

```bash
sudo apt-get install racket
```

è¿›è¡Œå®‰è£…ï¼Œå®Œæˆä¹‹åï¼Œæœ‰ä¸€ä¸ª ``racket`` çš„å¯æ‰§è¡Œç¨‹åº/REPL ï¼ŒåŠ ``drracket`` è¿™ä¸ªå¼€å‘ç¯å¢ƒ/IDEã€‚

``racket`` å¯ä»¥ç›´æ¥æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ï¼š

```bash
racket /home/zys/temp/demo.rkt
```

*racket* æä¾›äº†ç¼–è¯‘å™¨ï¼Œå¯ä»¥ç›´æ¥ç¼–è¯‘å¾—åˆ°å¯æ‰§è¡Œç¨‹åºã€‚


# åŸºæœ¬è¯­æ³• #

## åœ†æ‹¬å·å’Œæ–¹æ‹¬å· ##

*scheme* æ˜¯ç”¨ S è¡¨è¾¾å¼æ¥ç»„æˆçš„ï¼Œ *racket* ä¸­è¿™ç‚¹å¹¶æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯ *racket* ä¸­çš„ S è¡¨è¾¾å¼ï¼ŒåŒæ—¶æ”¯æŒåœ†æ‹¬å· ``()`` å’Œæ–¹æ‹¬å· ``[]`` ï¼Œè¿™ä¸ªæœºåˆ¶ï¼Œåœ¨æ‹¬å·åµŒå¥—åœºæ™¯ä¸‹ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„è§†è§‰è¯†åˆ«ï¼Œå¦‚ï¼š

```racket
#lang racket  

(define [add1 a b] [+ a b])
(define (add2 a b) (+ a b))

(add1 1 2)
(add2 1 2)
```

## æ³¨é‡Š ##

```racket
#lang racket  

;è¿™æ˜¯ä¼ ç»Ÿçš„å•è¡Œæ³¨é‡Š

#| 
è¿™æ˜¯ racket çš„ï¼Œå¯ä»¥å¤šè¡Œçš„ï¼Œ
    #|
        å¯ä»¥åµŒå¥—çš„æ³¨é‡Š
    |#
|#

#; æ³¨é‡Šä¸€ä¸ª "å•è¯­æ³•å•å…ƒ"
#;(display
    123) (display "1\n")
#;1 2 (display "2\n")
```

``#;`` çš„è¡Œä¸ºæ¯”è¾ƒç‰¹æ®Šï¼Œå…¶å®ƒè¯­è¨€ä¸­æ˜¯æ²¡æœ‰çš„ã€‚


## åŸºæœ¬æ•°æ®ç±»å‹ ##

```racket
#lang racket  

1
3.14
1/3
(+ 1/3 1/3)
6.02e+23
1+2i
#t
#f
"string"
"string\"ss\""
(display "string\"ss\"\n")
"Î»x:(Î¼Î±.Î±â†’Î±).xx"
"ã€â–¶ğŸ˜€ğŸ˜‚"
(display "ã€â–¶ğŸ˜€ğŸ˜‚\n")
```

åŸºæœ¬æ•°æ®ç±»å‹æœ‰ï¼šæ•´æ•°ï¼Œå°æ•°ï¼Œå®æ•°ï¼Œå¤æ•°ï¼Œå¸ƒå°”é‡ï¼ŒUnicode å­—ç¬¦ä¸²ã€‚

åé¢è¿˜ä¼šä¸“é—¨å¯¹å†…ç½®çš„æ•°æ®ç±»å‹ä½œä»‹ç»ã€‚


## é€»è¾‘è¿ç®—ï¼Œæ¡ä»¶åˆ¤æ–­ ##

TODO


## å®šä¹‰ä¸å‡½æ•°ï¼ŒåŒ¿åå‡½æ•° ##

*å®šä¹‰* ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ ``define`` ï¼Œå…¶å®åº”è¯¥è¯´ *ç»‘å®š* çš„ï¼š

```racket
#lang racket  

(define a 1)
(define b 2)
(+ a b)
```

åƒæ˜¯èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½å¯¹åŒä¸€ä¸ª *æ ‡è¯†* ï¼Œè¿›è¡Œé‡å¤çš„ ``define`` ã€‚

``define`` ä¹Ÿå¯ä»¥ç”¨äºå‡½æ•°çš„å®šä¹‰ï¼š

```
#lang racket  

(define [add a b] [+ a b])
(add 1 2)
```

ä½¿ç”¨ ``labmda`` çš„åŒ¿åå‡½æ•°ä¹Ÿè¡Œï¼š

```racket
#lang racket  

(define add [lambda (a b) (+ a b)])
(add 1 2)
```

## åˆ—è¡¨ï¼Œè¿­ä»£ ##

*åˆ—è¡¨* ï¼Œæ˜¯ *scheme* è¿™ç±»è¯­è¨€ï¼Œæœ€æ ¸å¿ƒçš„ä¸€ç§æ•°æ®ç»“æ„ã€‚å› ä¸ºï¼Œæˆ‘ä»¬å†™çš„ä»£ç ï¼Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ *åˆ—è¡¨* ã€‚è¿™ä¸ªæ€§è´¨æ˜¯ä¸€èˆ¬å¤§ä¼—åŒ–çš„è¯­è¨€æ²¡æœ‰çš„ã€‚


```racket
#lang racket  

(define add [lambda (a b) (+ a b)])
(add 1 2)

'(add 1 2)
'("add" "1" "2")
(list add 1 2)
(list "add" 1 2)
```

``list`` å‡½æ•°ï¼Œå’Œ ``'`` å‰ç¼€ï¼Œæ˜¯åŒæ ·çš„ä½œç”¨ï¼Œå°±æ˜¯å¾—åˆ°ä¸€ä¸ªåˆ—è¡¨ã€‚

*racket* å†…ç½®äº†å¾ˆå¤šé’ˆå¯¹åˆ—è¡¨çš„å‡½æ•°ï¼š

```racket
#lang racket  

(define any '(1 2 3 add "add"))
any
(length any)
(list-ref any 0)
(list-ref any 3)
(append any "1")
(append any '(2 "good"))
(reverse any)
```

``append`` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç±»å‹ä¸åŒï¼Œç»“æœæ˜¯ä¸åŒçš„ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸æ˜¯ *list* ï¼Œåˆ™ä¼šå¾—åˆ°ä¸€ä¸ª *Pair* ã€‚


*è¿­ä»£* çš„æ¦‚å¿µï¼Œç±»ä¼¼äºå…¶å®ƒè¯­è¨€ä¸­çš„é‚£ä¸€å †â€œå‡½æ•°å¼â€æ–¹æ³•ï¼Œåƒ ``map`` ``filter`` ``reduce`` ä¹‹ç±»çš„ã€‚

*racket* ä¸­æœ‰ ``map`` ``filter`` ``foldl`` ``andmap`` ``ormap`` ã€‚

```racket
#lang racket  

(map [lambda (n) (* n 2)] '[1 2 3 4 5])
(filter [lambda (n) (> n 4)] '[1 3 4 5 6 7 8])
(foldl [lambda (a b) (+ a b)] 0 '[1 2 3 4])
(andmap [lambda (n) (> n 4)] '[5 6])
(ormap [lambda (n) (> n 5)] '[5 6])
```

## åˆ—è¡¨ä¼ ç»Ÿ ##

``map`` ä¹‹ç±»çš„å‡½æ•°ï¼Œå¯¹äºâ€œè¿­ä»£â€æ¥è¯´ä¸æ˜¯å¿…é¡»çš„ï¼Œä¼ ç»Ÿä¸Šï¼Œåªéœ€è¦ ``car`` å’Œ ``cdr`` ä¸¤ä¸ªæ–¹æ³•å°±å¯ä»¥å®Œæˆå¯¹åˆ—è¡¨çš„éå†æ“ä½œï¼ŒåŸºäºå®ƒä»¬ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ ``map`` ``filter`` ç­‰ã€‚åœ¨ *racket* ä¸­ï¼Œå¯¹åº”çš„æ–¹æ³•æ˜¯ ``first`` å’Œ ``rest`` ï¼š

```racket
#lang racket  

(first '(1 2 3))
(rest '(1 2 3))
(first (rest '(1 2 3)))
(define l (cons 2 (cons 1 empty)))
(first l)
(rest l)
(empty? empty)
(empty? '())
(empty? '(1))
(empty? 1)
```

è¦å†™ä¸ªç®€å•çš„ ``map`` å°±å¾ˆå®¹æ˜“äº†ï¼š

```racket
#lang racket  

(define (my-map f lst)
  (if [empty? lst]
    lst
    [cons (f [first lst]) (my-map f [rest lst])] ))

(my-map (lambda (n) (+ n 1)) '(1 2 3))
```

``car`` , ``cdr`` ï¼Œç”šè‡³æ˜¯ ``pair`` è¿™ç±»ä¼ ç»Ÿæ¦‚å¿µåœ¨ *racket* ä¸­éƒ½æ˜¯å­˜åœ¨çš„ï¼Œä¸è¿‡å¹¶ä¸éœ€è¦åˆ»æ„å»ä½¿ç”¨å°±æ˜¯äº†ï¼š

```racket
#lang racket  

(pair? (cons 1 2))
(list? (cons 1 2))
(cons 1 2)
(car (cons 1 2))
(cdr (cons 1 2))
(car '(1 2 3))
(cdr '(1 2 3))
```


## å°¾é€’å½’ ##

å‰é¢å†™çš„ ``my-map`` ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒç›´æ¥çš„å®ç°ï¼Œå®ƒé€šè¿‡é€’å½’çš„æ–¹å¼ï¼Œä¾æ¬¡æŠŠ ``my-map`` çš„ç»“æœä½œä¸º ``cons`` çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™ç§ç»“æ„ä¸‹ï¼Œåœ¨åå¤è‡ªè°ƒç”¨ ``my-map`` çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»ä¿å­˜ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™ä¸æ˜¯ä¸€ç§é«˜æ•ˆçš„è¡¨ç°ã€‚

æ”¹è¿›çš„åŠæ³•ï¼Œæ˜¯è®©åå¤è‡ªè°ƒç”¨ ``my-map`` æ—¶ï¼Œéƒ½ä¸ä¾èµ–å¤–éƒ¨çš„ä»»ä½•ä¿¡æ¯ï¼Œæ‰€æœ‰ä¿¡æ¯éƒ½é€šè¿‡â€œå‚æ•°â€ä½“ç°ã€‚


```racket
#lang racket  

(define (my-map f lst)
  (define (iter f lst result)
    [if (empty? lst) (reverse result)
                         ;---------------------------;
      (iter f (rest lst) [cons (f (first lst)) result] )]
    )
  (iter f lst empty))

(my-map (lambda (n) (+ n 2)) '(1 2 3))
(my-map (lambda (n) (+ n 2)) empty)
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡è‡ªè°ƒç”¨ ``my-app`` æ—¶ï¼Œéƒ½åœ¨å°å¿ƒåœ°æ„é€ å®Œæ•´çš„ ``result`` å‚æ•°ï¼Œè¿™æ ·ï¼Œå½“æœ€ç»ˆæ»¡è¶³ç»“æŸè¿­ä»£çš„æ¡ä»¶æ—¶ï¼Œç›´æ¥è¿”å› ``result`` å³å¯ï¼Œä¸éœ€è¦é¢å¤–çš„â€œå›æº¯â€è¿‡ç¨‹ã€‚


ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ ``for/list`` ï¼ˆæˆ‘çŒœå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªå®ï¼‰æ¥å®Œæˆï¼š

```racket
#lang racket  

(define (my-map f lst)
             ;v;        ;v;
  (for/list ([i lst]) (f i)))

(my-map (lambda (i) (+ i 2)) '(1 2 3 4))
```

ç°åœ¨æˆ‘ä»¬å¹¶æ²¡æœ‰è®²è¿‡â€œå˜é‡â€ä¹‹ç±»çš„æ¦‚å¿µï¼Œåªæœ‰å‡½æ•°çš„â€œå‚æ•°â€ã€‚ä¸Šé¢ä»£ç ä¸­çš„ ``i`` ï¼Œè™½ç„¶çœ‹èµ·æ¥åƒâ€œå˜é‡â€ï¼Œä½†åœ¨å®å±•å¼€åï¼Œä¹Ÿå°±åªæ˜¯ä¸€ä¸ªå‡½æ•°å‚æ•°äº†ã€‚ä»å½¢å¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çŒœå‡ºï¼Œå¯¹äº ``for/list`` æ¥è¯´ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯å¯ä»¥æœ‰å¤šä¸ªè¿­ä»£çš„å–å€¼å¯¹ï¼Œè¿™äº›å–å€¼å¯¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå½¢å¼ä¸Šçš„åå­—ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¼šè¢«â€œæ±‚å€¼â€ã€‚

å†™ä¸€äº›ä¾‹å­è¯•è¯•ï¼š

```racket
#lang racket  

(for/list ([a '(1 2 3)]) ((lambda (i) (+ i 2)) a))

(for/list ([a '(1 2 3)]
           [b (reverse '(1 2 3))])
  ([lambda (i k) (+ i k)] a b))
```

åœ¨ *racket* ä¸­ï¼Œå®ƒå¹¶ä¸é¿è®³ä½¿ç”¨é€’å½’ï¼Œä¸æ˜¯è¯´ä¸€å®šè¦å°½é‡ä½¿ç”¨â€œè¿­ä»£â€ï¼ˆè¿­ä»£åªæ˜¯é€’å½’çš„ä¸€ç§ç‰¹æ®Šå½¢å¼è€Œå·²ï¼‰ã€‚åŒæ—¶ï¼Œå› ä¸ºè¯­è¨€æœºåˆ¶ï¼Œåœ¨ *racket* ä¸­å¹¶ä¸ä¼šæœ‰ *stack overflow* é—®é¢˜ï¼ˆä½†æ˜¯ä»ç„¶ä¼šä½¿ç”¨é¢å¤–çš„æ›´å¤šå†…å­˜ï¼‰ã€‚


## ä¸­ç¼€è¯­æ³• ##

è¿™ä¸ªï¼Œæ„Ÿè§‰åƒæ˜¯ *racket* è‡ªå·±ç©èŠ±æ´»ï¼Œé€šè¿‡â€œç‚¹â€ç¬¦å·ï¼Œ *racket* å®šä¹‰äº†ä¸€ç§ä¸­ç¼€è¡¨è¾¾å¼çš„æ ¼å¼ï¼š

```racket
#lang racket  

( (1 . + . 1) . + . 2 )
'(1 . + . 2)

(define (times base n) (base . * . n))
(10 . times . 2)
```

è¿™ç§è¡¨è¾¾å¼ï¼Œå¯ä»¥ç‰¹å®šä½¿ç”¨åœ¨ï¼Œæ¥æ”¶ 2 ä¸ªå‚æ•°çš„å‡½æ•°ä¸Šã€‚


# æ•°æ®ç±»å‹ #

## å¸ƒå°”å€¼ ##

``#t`` ``#f`` ``#T`` ``#F`` ï¼Œæ˜¯å¸ƒå°”å€¼ã€‚åœ¨é€»è¾‘åˆ¤æ–­ä¸­ï¼Œæ‰€æœ‰ä¸æ˜¯ ``#f`` ``#F`` çš„ï¼Œéƒ½ä¼šè¢«è®¤ä¸ºæ˜¯ ``#t`` ã€‚

ä½¿ç”¨ ``boolean?`` å¯ä»¥åšç²¾ç¡®çš„ç±»å‹åˆ¤æ–­ï¼š

```
#lang racket  

(boolean? #t)
(boolean? #T)
(boolean? 1)
(boolean? (not 1))
```


## æ•°å­— ##

æ•°å­—çš„æƒ…å†µåœ¨ *racket* ä¸­å¤æ‚ä¸€äº›ã€‚

ä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬ç†è§£æ•°å­—ç±»å‹ï¼Œå¯ä»¥åˆ†æˆ æ•´æ•°ï¼Œæµ®ç‚¹æ•°ï¼Œä¹‹ç±»çš„ã€‚ *racket* ä¸­ä¹Ÿæœ‰è¿™äº›æ¦‚å¿µï¼Œä½†åœ¨å®ƒä»¬ä¹‹ä¸Šï¼Œ *racket* ä¸­çš„æ•°å­—è¿˜è¢«åˆ†æˆâ€œç²¾ç¡®æ•°å­—â€ *exact* å’Œâ€œéç²¾ç¡®æ•°å­—â€ *inexact* ã€‚

åˆ†æ•°çš„ ``1/2`` å’Œæµ®ç‚¹æ•°çš„ ``0.5`` ï¼Œæ˜¯ä¸åŒçš„ã€‚ ``1/2`` æ˜¯ *exact* ï¼Œè€Œ ``0.5`` æ˜¯ *inexact* ã€‚

ç²¾ç¡®çš„æ•°å­—ç±»å‹æœ‰è¿™äº›ï¼š

- æ•´æ•°ï¼Œ ``1``, ``999999``, ``-12``
- åˆ†æ•°ï¼Œ ``1/2``, ``-3/5``
- å¤æ•°ï¼Œ ``1+2i`` , ``1/3-2/5j``


ä¸ç²¾ç¡®çš„æ•°å­—ç±»å‹æœ‰ï¼š

- æµ®ç‚¹ï¼Œ ``2.0``,  ``3.14e+10``
- æ— é™ï¼Œ ``+inf.0`` , ``-inf.0`` ï¼ˆå¿…é¡»æ˜¯è¿™ä¸¤ä¸ªï¼‰
- éæ•°å­—ï¼Œ ``+nan.0``, ``-nan.0``
- å¤æ•°ï¼Œ ``2.1+3.0i``, ``-inf.0+nan.0i``


åœ¨ä¹¦å†™æ—¶ï¼Œå¯ä»¥æ˜ç¡®è¡¨ç¤ºæ˜¯å¦ *exact* ï¼Œä½¿ç”¨ ``#e`` æˆ–è€… ``#i`` ï¼Œ *racket* å¯ä»¥è‡ªåŠ¨è½¬æ¢ï¼š

```racket
#e0.5 ;1/2
#i1/2 ;0.5
#e0.1 ;1/10
```

äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ï¼Œåˆ†åˆ«ä½¿ç”¨ ``#b``, ``#o``, ``#x`` ï¼š

```
#xFF ;255
#b100100 ;36
#o10 ;8
```

ç²¾ç¡®å€¼å’Œéç²¾ç¡®å€¼ä¹‹é—´ä½¿ç”¨ ``exact->inexact`` å’Œ ``inexact->exact`` è½¬æ¢ï¼š

```racket
(exact->inexact 1/3)
(inexact->exact 0.3333) ;éå¸¸å¤§çš„ä¸¤ä¸ªæ•´æ•°ç›¸é™¤
```

ä¸åŒç±»å‹çš„æ€§èƒ½è¡¨ç°æ–¹é¢ï¼š å°çš„æ•´æ•° > æµ®ç‚¹ > è¶…å¤§æ•´æ•°å’Œå…¶å®ƒç²¾ç¡®æ•°


æ•°å­—çš„æ¯”è¾ƒï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œ ``=`` å’Œ ``eqv?`` ï¼Œå‰è€…ä¼šå°è¯•è½¬æ¢åˆ°ç²¾ç¡®å€¼åå†æ¯”è¾ƒï¼Œåè€…ä¸ä¼šï¼š

```racket
(= 1 1.0) ;t
(= 1/3 0.333333) ;f
(eqv? 1 1.0) ;f
(eqv? 1 3/3) ;t
```

## å­—ç¬¦å’Œå­—ç¬¦ä¸² ##

*racket* ä¸­çš„ *å­—ç¬¦* æŒ‡ä¸€ä¸ª Unicode å€¼ã€‚å¯ä»¥ä½¿ç”¨ ``#\`` ï¼Œ ``#\u`` , ``#\space`` ``#\newline`` è¿™äº›è¡¨ç¤ºæ³•ã€‚åŒæ—¶ï¼Œä½¿ç”¨ ``char->integer`` å’Œ ``integer->char`` å®Œæˆæ•°å­—å’Œå­—ç¬¦çš„è½¬æ¢ï¼š

ä½¿ç”¨ ``char=?`` å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ï¼Œæˆ–è€… ``char-ci=?`` å¿½ç•¥å¤§å°å†™ï¼š

```racket
(char=? #\a #\a)
(char-ci=? #\a #\A)
(char=? #\a #\u61)
(char=? #\ã€ #\ã€)
```

*å­—ç¬¦ä¸²* æ˜¯å›ºå®šé•¿åº¦çš„å­—ç¬¦æ•°ç»„ï¼Œä½¿ç”¨åŒå¼•å·åŒ…èµ·æ¥ã€‚

```racket
(display "\u03BB\u03BB\n\u03BB")
```

å­—ç¬¦ä¸²åˆ†ä¸ºâ€œå¯å˜â€å’Œâ€œä¸å¯å˜â€ä¸¤ç§æƒ…å†µã€‚ç›´æ¥å†™æ­»çš„æ˜¯ä¸å¯å˜çš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡ä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°å¯å˜çš„å­—ç¬¦ä¸²ï¼š

```racket
#lang racket  

(define s (make-string 10 #\.))
(display s)
(display "\n")
(string-set! s 2 #\x)
(display s)
```


## å­—èŠ‚å’Œå­—èŠ‚ä¸² ##

*racket* çš„ *å­—èŠ‚*ï¼Œå°±æ˜¯ *0-255* çš„æ•´æ•°ï¼š

```racket
(byte? 0) ;#t
(byte? 256) ;#f
```

*å­—èŠ‚ä¸²* æ˜¯ä½¿ç”¨ *#* å‰ç¼€çš„å­—ç¬¦ä¸²æ ·å­ï¼š

```racket
#"Hello"
"Hello"

(define b (make-bytes 10 0))
(bytes-set! b 0 97)
b
```

å¦‚æœä½¿ç”¨ ``display`` å‡½æ•°å»è¾“å‡ºå­—èŠ‚ä¸²çš„è¯ï¼Œå®ƒä¼šæŒ‰ UTF-8 çš„ç¼–ç æ–¹å¼å¤„ç†ã€‚

å­—èŠ‚ä¸²å’Œå­—ç¬¦ä¸²çš„ç›¸äº’è½¬æ¢ï¼Œéœ€è¦ä½¿ç”¨ä¸“é—¨çš„å‡½æ•°å®ç°ï¼š

```racket
(bytes->string/utf-8 #"\xCE\xBB") ;Î»
```

## ç¬¦å· ##

ç¬¦å· *Symbol* æ˜¯å…ƒç¼–ç¨‹ä¸­éå¸¸åŸºç¡€çš„æ¦‚å¿µï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š

```racket
(first '(define a 1))
(first '("define" a 1))
```

å®ƒä»¬è¿”å›çš„æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ

ç¬¬ä¸€è¡Œä»£ç ï¼Œè¿”å›çš„å°±æ˜¯ ``define`` ç¬¦å·ï¼š

```racket
(eq? [first '(define a 1)] 'define)
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ ``gensym`` å‡½æ•°ï¼Œæ¥è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç³»ç»Ÿå”¯ä¸€çš„ç¬¦å·ï¼Œè¿™åœ¨ä¸€äº›å®å±•å¼€çš„å®ç°ä¸­ï¼Œæ˜¯å¿…é¡»çš„ï¼š

```racket
(define s (gensym))
```

``string->uninterned-symbo`` å‡½æ•°ï¼Œå¯ä»¥æŠŠä¸€ä¸ªå­—ç¬¦ä¸²è½¬æˆå”¯ä¸€ç¬¦å·ï¼š

```racket
(eq? [string->uninterned-symbol "a"] [string->uninterned-symbol "a"]) ;#f
```

## å…³é”®è¯ ##

*å…³é”®è¯*ï¼Œ *Keyword* ï¼Œæ˜¯ *racket* ä¸­æ–°çš„æ¦‚å¿µï¼Œæ„Ÿè§‰è·Ÿå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­çš„â€œå…³é”®è¯å‚æ•°â€æ˜¯ä¸€æ ·çš„ï¼Œå…·ä½“çš„ä½œç”¨ï¼Œä¹Ÿæ˜¯é™¤äº†å‡½æ•°å‚æ•°ä¸­çš„â€œå…³é”®è¯å‚æ•°â€ï¼Œæˆ‘è¿˜ä¸çŸ¥é“èƒ½åšä»€ä¹ˆã€‚

å½¢å¼ä¸Šï¼Œä¸ *Symbol* ç±»ä¼¼ï¼Œæ¯”å¦‚ ``#:hello`` ï¼Œä½†æ˜¯å®ƒä»¬æ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼š

```racket
(symbol? '#:app)
(keyword? '#:app)
```

ä½¿ç”¨ä¸Šï¼Œæ”¾åœ¨å‚æ•°å‰é¢å°±å¯ä»¥äº†ï¼š

```racket
#lang racket  

(define (lst a b #:a ka #:b kb) (list a b ka kb))
(lst 1 2 #:a 3 #:b 4)
(lst #:b 3 1 2 #:a 1)
```

æœ‰äº† *keyword* æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¼ å‚æ—¶ï¼Œé¡ºåºä¸Šæ²¡æœ‰é™åˆ¶ã€‚é *keyword* å‚æ•°ï¼Œå†æŒ‰é¡ºåºåŒ¹é…ã€‚


## åˆ—è¡¨å’Œç»“å¯¹ ##

è¿™ä¸ªå‰é¢å·²ç»ä½¿ç”¨è¿‡å¾ˆå¤šäº†ã€‚


```racket
#lang racket  

(cons 1 2)
(cons 1 '(2))
(cons 1 null)
(cons 1 empty)

(display "-----\n")

(empty? null)
(null? empty)

(display "-----\n")

(list? '(1 . 2))
(list? '(1 2))

(display "-----\n")

(pair? '(1 2))
(pair? '(1 . 2))
```

å¯ä»¥çœ‹å‡ºï¼Œ *list* æ˜¯ *pair* çš„ç‰¹æ®Šæƒ…å†µã€‚


## å‘é‡ ##

*å‘é‡*ï¼Œ *Vector* ï¼Œæ˜¯ *racket* é¢„ç½®çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚å¦‚æœè¯´ *list* æ˜¯é“¾è¡¨ï¼Œé‚£ *vector* å°±åƒä¼ ç»Ÿå®šé•¿æ•°ç»„äº†ï¼Œå®ƒå¯ä»¥åœ¨ ``O(1)`` æ—¶é—´è®¿é—®æŒ‡å®šæˆå‘˜ã€‚

åŒæ—¶ï¼Œè·Ÿ *strings* ä¸€æ ·ï¼Œ *vector* ä¹Ÿåˆ†å¯å˜çš„ï¼Œæˆ–è€…ä¸å¯å˜çš„ã€‚

å½¢å¼ä¸Šï¼Œå¯ä»¥çœ‹æˆåŠ äº† ``#`` å‰ç¼€çš„åˆ—è¡¨ï¼Œæˆ–è€…æ˜¯åŠ äº† ``#19`` è¿™ç§å‰ç¼€çš„åˆ—è¡¨ï¼Œ ``#`` åé¢å¯ä»¥æœ‰ä¸€ä¸ªå¯é€‰çš„é•¿åº¦ã€‚

å¦‚æœæŒ‡å®šäº†é•¿åº¦ï¼Œåˆ™ä¼šä½¿ç”¨æœ€åä¸€ä¸ªæˆå‘˜å¡«å……åˆ°æŒ‡å®šé•¿åº¦ã€‚


```racket
#(1 2 x3 display)
#8(1 2 x3 display)

(vector 1 2 3 'define)
(vector-ref #(1 2 3 define) 3)
```

## ä¸‰ç§ä¸åŒçš„â€œç­‰äºâ€ ##

ä¸‹é¢ä»‹ç»çš„â€œå“ˆå¸Œè¡¨â€ï¼Œæ¶‰åŠä¸‰ç§ä¸åŒçš„ *key* çš„åŒ¹é…æ–¹å¼ï¼Œåˆ†åˆ«å¯¹äºä¸‰ç§æ¯”è¾ƒå‡½æ•°ï¼š

- ``equal?``
- ``eqv?``
- ``eq?``


``eq?`` ç®—æ˜¯æœ€ä¸¥æ ¼çš„ï¼Œå®ƒéœ€è¦ä¸¤è€…æ˜¯ç›¸åŒçš„å¯¹è±¡ï¼š

```racket
(eq? 1 1)
(eq? 1.0 1.0)
(eq? 1.0 1) ;#f
(eq? (expt 2 10) (expt 2 10))
(eq? (expt 2 10) 1024)
(eq? (expt 2 100) (expt 2 100)) ;#f
(eq? (cons 1 2) (cons 1 2)) ;#f
(eq? 1/2 2/4)
(eq? "hello" "hello")
(eq? "hello" (bytes->string/utf-8 #"hello")) ;#f
```

è¿™é‡Œæ³¨æ„ï¼Œå¤§æ•´æ•° ``(expt 2 100)`` å¯èƒ½æ˜¯ä¸åŒå¯¹è±¡ã€‚

``eqv?`` ï¼Œæ˜¯åœ¨ ``eq?`` åŸºç¡€ä¸Šï¼Œæœ‰ä¸€äº›â€œæ”¾å®½â€ï¼Œåœ¨æ•°å­—ï¼š

```racket
(eq? (expt 2 100) (expt 2 100)) ;#f
(eqv? (expt 2 100) (expt 2 100)) ;#t
```

``equal?`` æ˜¯æœ€å¸¸ç”¨çš„åˆ¤æ–­ï¼Œå®ƒæ˜¯æ™®éæ„ä¹‰ä¸Šçš„â€œå€¼â€çš„æ¯”è¾ƒï¼ˆ ``eq?`` å’Œ ``eqv?`` çš„ ``true`` è‚¯å®šä¹Ÿæ˜¯ ``equal?`` çš„ ``true``ï¼‰ï¼š

```racket
(equal? 1.0 1) ;#f
(equal? (expt 2 100) (expt 2 100)) ;#t
(equal? (cons 1 2) (cons 1 2)) ;#t
(equal? "hello" (bytes->string/utf-8 #"hello")) ;#t
(equal? '(1 2 3) '(1 2 3)) ;#t
```


## å“ˆå¸Œè¡¨ ##

*Hash Table* ä¹Ÿæ˜¯ä¸€ç§ *racket* å†…ç½®çš„æ•°æ®ç»“æ„å®ç°ã€‚å®ƒå¯ä»¥åˆ†ä¸ºå¯å˜å’Œä¸å¯å˜çš„ä¸¤å¥—ï¼Œå¯¹äºä¸å¯å˜çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥â€œæ‰©å±•å®ƒæ„å»ºæ–°çš„ç»“æ„â€ã€‚åŒæ—¶ï¼Œæ ¹æ® *key* çš„æ¯”è¾ƒè§„åˆ™ä¸åŒï¼Œåˆè¿›ä¸€æ­¥åˆ†æˆä¸‰ç§å­ç±»ï¼Œåˆ†åˆ«ä½¿ç”¨ ``equal?`` ``eqv?`` ``eq?`` ä½œä¸º *key* çš„æ¯”è¾ƒã€‚

æ„å»ºå¯å˜çš„ *Hash Table* ï¼Œå¯ä»¥ä½¿ç”¨ ``make-hash`` ``make-hasheqv`` ``make-hasheq`` å‡½æ•°ï¼Œæ„å»ºä¸å¯å˜çš„ç»“æ„ï¼Œå‡½æ•°å°±åˆ†åˆ«æ˜¯ ``hash`` ``hasheqv`` ``hasheq`` ã€‚

å¯å˜çš„ç»“æ„ï¼š

```racket
#lang racket  

(define ht (make-hash))
(hash-set! ht "first" 1)
(hash-set! ht 'second '(1 2 hello))
(hash-set! ht 3 'world)

(hash-ref ht 'second)
(hash-ref ht 3)
(hash-ref ht "first")
```

ä¸å¯å˜çš„ç»“æ„ï¼Œé™¤äº† ``hash`` å‡½æ•°ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ ``#hash`` è¯­æ³•ï¼š

```racket
(define ht [hash "first" 1 'second "two" 3 'third])
(hash-ref ht 3)
; error
; (hash-set! ht "first" 2)

(define ht #hash(["first" . 1] [second . "two"] [3 . 'third]))
(hash-ref ht 'second)
```

``#hash`` æ„Ÿè§‰æ˜¯ä¸€ä¸ªå®ï¼Œé‡Œé¢ä¸èƒ½å†ä½¿ç”¨ *symbol* ï¼Œç›´æ¥å†™çš„æ ‡è¯†å°±æ˜¯ *symbol* ï¼Œå–å€¼æ—¶è¦æ³¨æ„ã€‚

å¯¹äº *Hash Table* ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ ``hash-set`` æ–¹æ³•å¾—åˆ°ä¸€ä¸ªæ–°å¯¹è±¡ï¼š

```racket
(define ht [hash "first" 1 'second "two" 3 'third])
(hash-ref ht 3)

(define new_ht (hash-set ht "four" 444))
(hash-ref new_ht "four")
(hash-ref new_ht "first")
```



## å°ç®± ##

*å°ç®±* è¿™ä¸ªåå­—æ˜¯æˆ‘è‡ªå·±è¯‘çš„ï¼ŒæŒ‡çš„å°±æ˜¯ *Box* è¿™ç§æ•°æ®ç±»å‹ã€‚

å®ƒåˆçœ‹å¥½åƒæ²¡å•¥ç”¨ï¼Œæˆ‘ä¸ªäººç›®å‰çš„çœ‹æ³•ï¼Œæ˜¯å®ƒæä¾›äº†ä¸€ç§ç›´æ¥çš„â€œå¼•ç”¨â€çš„è¡¨è¾¾èƒ½åŠ›ï¼Œåƒâ€œæŒ‡é’ˆâ€ã€‚åŒæ—¶ï¼Œç½‘ä¸Šæœ‰äººæï¼Œ *Box* å¯èƒ½å¯¹äºåº”ç”¨å¼€å‘åœºæ™¯æ¥è¯´ä¸é‡è¦ï¼Œä½†æ˜¯å¯¹äºâ€œè¯­è¨€å¼€å‘â€åœºæ™¯ï¼Œå®ƒæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚

*Box* çš„å€¼æ‰“å°å‡ºæ¥æ—¶ï¼Œä¼šæ˜¯åƒ ``'#&2`` è¿™ç§ï¼Œä»¥ ``#&`` å¼€å¤´ã€‚

```
#lang racket  


(define p (box 1))
(define (add1 p1) (set-box! p (+ (unbox p) 1)))
(add1 p)
p

(define r 1)
(define (add2 v) (set! v (+ v 2)))
(add2 r)
r
```

ä»å¦ä¸€ä¸ªæ–¹é¢æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°éœ€è¦ä½ ä¼ å…¥ *Box* ï¼Œé‚£ä¹ˆä¹Ÿå°±å¯ä»¥è¡¨ç¤ºï¼Œè¿™ä¸ªå‡½æ•°ä¼šç›´æ¥æ›´æ”¹å®ƒï¼Œè€Œä¸æ˜¯è¿”å›ä¸€ä¸ªæ–°å€¼ã€‚


## Void å’Œ Undefined ##

è¿™æ˜¯ä¸¤ä¸ªç‰¹æ®Šçš„å€¼ï¼Œ ``(void)`` æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ° ``#<void>`` ç±»å‹çš„è¿”å›ï¼Œå®ƒè¡¨ç¤ºâ€œæ— â€ï¼Œæ¯”å¦‚ ``display`` å‡½æ•°å°±æ˜¯æ²¡æœ‰è¿”å›çš„ã€‚

```racket
(void 1 2 3)
```

``#<undefined>`` ï¼Œå¯ä»¥åœ¨ä¸€äº›æœªåˆå§‹åŒ–å€¼çš„è®¿é—®æ—¶å‡ºç°ï¼ˆä¹Ÿå¯èƒ½æŠ¥é”™ï¼‰ã€‚


# å…¶å®ƒè¡¨è¾¾å¼ç»†èŠ‚ #

## å‡½æ•°è°ƒç”¨å’Œå‚æ•° ##

### å‡½æ•°çš„ apply è°ƒç”¨ ###

``apply`` å¯ä»¥ç”¨äºâ€œå±•å¹³â€å‡½æ•°è°ƒç”¨å‚æ•°ï¼š

```racket
(+ 1 2 3)
(define (sum lst) (apply + lst))
(sum '(1 2 3))
```

åŸºæœ¬å¯ä»¥å¤šåŠ ä¸€ä¸ªå‚æ•°ï¼š

```racket
(apply - 0 '(1 2 3))
(- 0 1 2 3)
```

### å‡½æ•°çš„ä¸å®šå‚æ•° ###

å‚æ•°åˆ—è¡¨çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ *ç‚¹* åˆ†å‰²ï¼Œåˆ™æœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè¡¨ç¤ºå‰©ä¸‹çš„ä¸å®šå‚æ•°ï¼š

```racket
(define (sum a b . c) (+ a b (apply + c)))
(sum 1 2 3 4 5 6 7 8 9 10)
```

### å‡½æ•°çš„é»˜è®¤å‚æ•° ###

å‚æ•°åˆ—è¡¨ä¸­ï¼Œä¸­æ‹¬å·æ‹¬èµ·æ¥çš„ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªé»˜è®¤å€¼ï¼š

```racket
(define (sum a [b 100] . c) (+ a b (apply + c)))
(sum 1)
```

### å‡½æ•°çš„å…³é”®è¯å‚æ•° ###

å…³é”®è¯å‚æ•°ï¼Œå¯ä»¥å’Œé»˜è®¤å‚æ•°æ··åˆä½¿ç”¨ï¼š

```racket
(define (sum a #:b [b 100] . c) (+ a b (apply + c)))
(sum #:b 10 1 2 3)
```

### å‡½æ•°çš„æ ¹æ®å‚æ•°åŒ¹é… ###

æ¨¡å¼åŒ¹é…è¿™ç§æ—¶é«¦çš„ä¸œè¥¿ï¼Œ*racket* è‡ªç„¶ä¸ä¼šé”™è¯¯ã€‚é€šè¿‡ ``case-lambda`` å¯ä»¥å®ç°æ ¹æ®å®é™…å‚æ•°ä¸ªæ•°ï¼Œè°ƒç”¨ä¸åŒçš„é€»è¾‘ï¼š

```racket
#lang racket  

(define something 
  (case-lambda
    [(a) (+ a 1)]
    [(a b) (* a b)]
    [(a b c) ((+ a b) . - . c)]
))

(something 1)
(something 2 10)
(something 2 10 30)
```

## å¤šå€¼è¿”å›å’Œå¤šå€¼å®šä¹‰ ##

è¿™é‡Œè¯´çš„â€œå¤šå€¼è¿”å›â€ï¼Œæ˜¯çœŸæ­£çš„å¤šå€¼è¿”å›ï¼Œä¸æ˜¯ç”¨åˆ—è¡¨æçš„â€œæ¨¡å¼åŒ¹é…â€ã€‚

ä½¿ç”¨ ``values`` å®Œæˆå¤šå€¼è¿”å›ï¼Œå¯¹åº”çš„ä½¿ç”¨ ``define-values`` å®Œæˆå¤šå€¼å®šä¹‰ï¼š

```racket
(define-values (a b) (values 1 2))
a
b
```

## å¤šç§æ•°æ®ç»‘å®šæ–¹å¼ ##

### let, let*, letrec ###

- ``let`` åªèƒ½åœ¨ ``body`` ä¸­å¯è§ã€‚
- ``let*`` åœ¨å…¶å®ƒ ``let`` ä¸­ä¹Ÿå¯è§ã€‚
- ``letrec`` è¡¨è¾¾å¼â€œæå‰â€å¯è§ï¼Œå¯ä»¥åœ¨é€’å½’ä¸­ä½¿ç”¨ã€‚


``let`` æ˜¯æœ€æ™®é€šçš„ï¼š

```racket
(let ([a 1]) (+ a 1))
```

``let*`` æ˜¯åœ¨å®šä¹‰è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å‰é¢çš„å€¼ï¼š

```racket
(let* ([a 1] [b (+ a 1)]) (+ a b))
```

``letrec`` æ˜¯å¯ä»¥â€œæå‰â€ä½¿ç”¨å°†è¦å®šä¹‰çš„å€¼ï¼Œå¯ä»¥ç”¨äºé€’å½’ï¼š

```racket
#lang racket  

(letrec
  ([last-of-lst
     (lambda (lst)
       (if [empty? (rest lst)]
         (first lst)
         (last-of-lst (rest lst))))])
  (last-of-lst '(1 2 3 4 5)))
```


### å‘½åç»‘å®š ###

ä½¿ç”¨ ``let`` æ—¶åœ¨åé¢è·Ÿä¸€ä¸ªåå­—ï¼Œç­‰äºå®šä¹‰äº†ä¸€ä¸ªè¿™ä¸ªåå­—çš„å‡½æ•°ï¼Œå¹¶ä¸”ç”¨ ``let`` çš„å€¼ä½œä¸ºå‚æ•°é©¬ä¸Šè°ƒç”¨ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥ç”¨äºé€’å½’ï¼š

```racket
(let add ([a 4] [b 2])
  [if (= a 0) b (add (- a 1) (+ b b))])
```


### å¤šå€¼ç»‘å®š ###

å¤šå€¼ç»‘å®šæ˜¯ä¸ºäº†é…åˆâ€œå¤šå€¼è¿”å›â€çš„ä¸€å¥—å®ç°ï¼Œ ``let-values``, ``let*-values``, ``letrec-values`` ï¼š

```racket
(let-values (([a b c] [values 1 2 3])) [+ a b c])
```


## å¤šè¯­å¥åºåˆ— ##

å¦‚æœæ‰“ç®—åœ¨ä¸€ä¸ªè¡¨è¾¾å¼é‡Œé¢ï¼Œåšå¤šä»¶äº‹ï¼Œå¯ä»¥ä½¿ç”¨ ``begin`` æˆ–è€… ``begin0`` æŠŠè¿™ä¸ªè¡¨è¾¾å¼åŒ…èµ·æ¥ï¼Œå°±å¯ä»¥å†™å¤šä¸ªè¯­å¥äº†ã€‚

å®ƒä»¬ä¹‹å‰çš„ä¸åŒåœ¨äºï¼Œ ``begin`` è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œè€Œ ``begin0`` è¿”å›ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼çš„å¼ã€‚

```racket
(define (func a)
  (if (> a 1)
    [begin0
      a
      (display "a > 1\n")]
    [begin0
      0
      (display "a <= 1\n")]))

(func 1)
(func 2)
```

ä¸Šé¢çš„ä»£ç æ³¨æ„åŒºåˆ« ``display`` è¾“å‡ºçš„å†…å®¹ï¼Œä¸ ``(func 1)`` çš„è¿”å›å€¼ã€‚

``when`` å’Œ ``unless`` æ˜¯ç±»ä¼¼ ``if`` çš„åŠŸèƒ½ï¼Œä¸è¿‡å®ƒä»¬åé¢ç›´æ¥å¯ä»¥è·Ÿå¤šæ¡è¯­å¥ï¼Œè€Œä¸ç”¨ä¸“é—¨å†™ ``begin`` äº†ï¼š

```racket
(define (func a) (when [> a 1]
                   [display "1\n"]
                   [display "2\n"]
                   "OK"))
(func 1)
(func 2)
```

## å¼•ç”¨ä¸æ±‚å€¼ ##

```racket
(list 1 2 3)
'(1 2 3)
(quote (1 2 3))
```

ä¸Šé¢ä¸‰ä¸ªè¯­å¥çš„è¿”å›æ˜¯ä¸€æ ·çš„ã€‚ *lisp* ç³»åˆ—è¯­è¨€æœ€é£éªšçš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒçš„è¯­å¥å°±æ˜¯ *åˆ—è¡¨*ï¼Œæ‰€ä»¥ç´§æ¥ç€çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä»€ä¹ˆæ—¶å€™åº”è¯¥å¯¹ä¸€ä¸ªåˆ—è¡¨ *æ±‚å€¼* ï¼Œä»€ä¹ˆæ—¶å€™å°±æŠŠå®ƒå½“æˆæ˜¯ä¸€ä¸ª *åˆ—è¡¨ç»“æ„* ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£æˆï¼Œæ€»æ˜¯ä¼šæ±‚å€¼ï¼Œåªæ˜¯ï¼Œåƒ ``quote`` è¿™ä¸ªå‡½æ•°ï¼Œå®ƒæ±‚å€¼çš„ç»“æ„å°±æ˜¯å®ƒçš„å‚æ•°åˆ—è¡¨è€Œå·²ã€‚

åŒæ—¶ï¼Œåˆå› ä¸ºä½¿ç”¨â€œåˆ—è¡¨ç»“æ„â€æ˜¯å¦‚æ­¤æ™®éï¼Œæ‰€ä»¥é’ˆå¯¹ ``quote`` å‡½æ•°çš„è°ƒç”¨ï¼Œä¸“é—¨ç»™äº†å®ƒä¸€ä¸ªç‰¹æ®Šå½¢å¼ï¼Œå°±æ˜¯å†™æˆ ``'(1 2 3)`` è¿™ç§ï¼Œå®ƒå°±ç›¸å½“äº ``(quote (1 2 3))`` ã€‚

å¦å¤–ä¸€ä¸ª ``quasiquote`` ï¼Œä½œç”¨å’Œ ``quote`` æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å®ƒåœ¨ä¸æ±‚å€¼çš„åˆ—è¡¨å½“ä¸­ï¼Œå¯ä»¥æ··å…¥éƒ¨åˆ†çš„æ±‚å€¼ï¼š

```racket
(quasiquote (1 2 (unquote (+ 1 2))))
```

ä½¿ç”¨ ``unquote`` åŒ…èµ·æ¥çš„éƒ¨åˆ†ï¼Œåˆæ˜¯éœ€è¦æ±‚å€¼çš„ï¼Œæœ‰ç‚¹åƒä¸€ä¸ªæ¨¡æ¿ã€‚

å¦å¤–ä¸€ä¸ª ``unquote-splicing`` å’Œ ``unquote`` ç±»ä¼¼ï¼Œåªæ˜¯å®ƒåé¢çš„è¡¨è¾¾å¼éœ€è¦è¿”å›ä¸€ä¸ª *list* ï¼š

```racket
(quasiquote (1 2 (unquote-splicing '(1 2 3))))
```

è¿™ç§å¼•ç”¨ï¼Œæ±‚å€¼ï¼Œåå¼•ç”¨çš„å¤æ‚å…³ç³»ï¼Œå°±ä½¿å¾—æˆ‘ä»¬å†™çš„ä»£ç ï¼Œåˆ°åº•æ˜¯åœ¨æ±‚å€¼ï¼Œè¿˜æ˜¯åœ¨ç”Ÿæˆå¦å¤–ä¸€éƒ¨åˆ†ä»£ç ï¼Œä¹‹é—´çš„ç•Œé™å˜å¾—éå¸¸æ¨¡ç³Šäº†ã€‚

è€Œè¿™äº›å…ƒç¼–ç¨‹çš„åŸºç¡€ç»“æ„ï¼Œå…¶åœ°ä½ä¹‹æ˜¾èµ«ï¼Œéƒ½æœ‰ä¸“é—¨ç»“æ„ç‰¹æ®Šå¯¹å¾…çš„ï¼š

- ``'`` æ˜¯ ``quote``, ``'(1 2 3)``
- ````` æ˜¯ ``quasiquote`` , ```(1 2 3)``
- ``,`` æ˜¯ ``unquote`` , ```(1 2 ,(+ 1 2))``
- ``,@`` æ˜¯ ``unquote-splicing`` , ```(1 2 ,@(list 1 2))``


## åˆ†æ”¯åˆ¤æ–­ ##

å‰é¢ç”¨è¿‡äº† ``if`` ï¼Œæ›´ä¸€èˆ¬å½¢å¼çš„æ˜¯ ``cond`` ï¼š

```racket
#lang racket  

(define (func a)
  (cond ([= a 1] 10)
        ([= a 2] 100)
        ([= a 3] 1000)
        (else 10000)))

(func 1)
(func 3)
```

æ™®é€šæƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ ``case`` :

```racket
(define (func a)
  (case a
    [(1) 10]
    [(2) 100]
    [(3 4 5) 1000]
    [else 10000]))

(func 3)
(func 8)
```


## ä¸“ç”¨å‚æ•° ##

*ä¸“ç”¨å‚æ•°* è¿™ä¸ªåå­—æ˜¯æˆ‘è‡ªå·±å–çš„ï¼Œæ–‡æ¡£ä¸­æ˜¯ *parameterize* ã€‚

æˆ‘ä¸ªäººç†è§£ï¼Œè¿™ä¸ªæœºåˆ¶ï¼Œæ˜¯å¤„ç†â€œé…ç½®æ€§â€å†…å®¹çš„ç»ä½³é€‰æ‹©ï¼Œå®ƒèåˆäº†â€œå˜é‡â€ï¼Œâ€œä¸Šä¸‹æ–‡â€ï¼Œâ€œä½œç”¨åŸŸâ€ç­‰æ¦‚å¿µã€‚


ä½¿ç”¨æ–¹æ³•ä¸Šï¼Œå…ˆç”¨ ``define`` åŠ  ``make-parameter`` å®šä¹‰ä¸€ä¸ªåˆå§‹å€¼ï¼Œç„¶ååœ¨ä½¿ç”¨çš„åœ°æ–¹ï¼Œç”¨ ``parameterize`` â€œä¸´æ—¶èµ‹å€¼â€ã€‚

```racket
#lang racket  

(define times (make-parameter 10))
(define (func n) (* n (times)))

(func 10)

(parameterize ([times 2])
  [begin0
    (func (parameterize ([times 1]) (func 5)))
    (parameterize ([times 1000]) '())
    ])

(times)
```

- ä½¿ç”¨â€œè°ƒç”¨â€è·å–å‚æ•°å€¼ã€‚
- å‚æ•°çš„å€¼æ˜¯åœ¨ ``(parameterize)`` ç»“æ„ä¸­ï¼Œè¢«å±‚å±‚é™åˆ¶ä½œç”¨åŸŸçš„ã€‚
- ç¦»å¼€ ``(parameterize)`` ä¹‹åï¼Œå‚æ•°å€¼ä¼šè‡ªåŠ¨â€œè¿˜åŸâ€ã€‚



# è‡ªå®šä¹‰ç»“æ„ #

## åŸºæœ¬ç”¨æ³• ##

ä½¿ç”¨ ``struct`` å¯ä»¥è‡ªå®šä¹‰ä¸€ç§ç»“æ„ï¼š

```racket
(struct point (x y))
(define p (point 1 2))
```

å®šä¹‰ä¹‹åï¼Œç»“æ„çš„åå­—ï¼Œå°±æ˜¯è¿™ä¸ªç»“æ„â€œå®ä¾‹åŒ–â€çš„å‡½æ•°åã€‚åŒæ—¶ï¼Œä¼šå­˜åœ¨ä¸€ç³»åˆ—ä¸ç»“æ„åç›¸å…³çš„å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†ç»“æ„çš„å®ä¾‹ï¼š

```racket
(point? p)
(point-x p)
```

ç»“æ„å¯ä»¥è¢«æ‰©å±•ï¼Œæˆ–è€…è¯´ï¼Œå¯ä»¥ç»§ç»­å®šä¹‰å­ç»“æ„ï¼š


```racket
(struct point (x y))
(struct point-3d point (z))
(define p (point-3d 1 2 3))
(point? p)
(point-3d? p)
(point-3d-z p)
;(point-3d-x p)
(point-x p)
```

``point-3d`` æ˜¯ ``point`` çš„å­ç»“æ„ï¼Œæ‰€ä»¥ ``p`` åœ¨ ``point?`` å’Œ ``point-3d?`` çš„ç»“æœéƒ½ä¼šæ˜¯ ``#t`` ã€‚

ä½†æ˜¯åœ¨è·å–å±æ€§å€¼çš„æ—¶å€™ï¼Œå­ç»“æ„åªèƒ½è·å–è‡ªå·±çš„é‚£éƒ¨åˆ†ï¼Œå¦åˆ™å°±éœ€è¦ä½¿ç”¨çˆ¶ç»“æ„çš„æ–¹æ³•ï¼Œæ¯”å¦‚ä¸Šé¢ä»£ç ä¸­çš„ ``(point-3d-x p)`` å°±ä¼šæŠ¥é”™ã€‚

ç»“æ„ä¹Ÿå¯ä»¥å¤åˆ¶æ›´æ–°ï¼š

```racket
(struct point (x y))
(define p (point 1 2))
(define p2 (struct-copy point p (y 10)))
(point-x p2)
(point-y p2) ;10
```

## é€æ˜ç»“æ„å’Œè™šæ‹Ÿç»“æ„ ##

å‰é¢ä»‹ç»çš„ ``struct`` æ™®é€šç”¨æ³•ï¼Œå¯ä»¥æ­£å¸¸å¾—åˆ°ä¸€ä¸ªç»“æ„å®ä¾‹ã€‚ä½†æ˜¯è¿™ä¸ªå®ä¾‹åœ¨åç»§çš„ä½¿ç”¨ä¸­ï¼Œæ— æ³•å†è¢«äº†è§£åˆ°æ„é€ æ—¶çš„æƒ…å†µï¼Œæˆ‘ä»¬æŠŠå®ä¾‹æ‰“å°å‡ºæ¥ï¼Œçœ‹åˆ°çš„ä¹Ÿåªæ˜¯ç±»å‹ ``#<point>`` è¿™æ ·çš„ä¿¡æ¯ï¼Œä¸çŸ¥é“åœ¨æ„é€ æ—¶çš„å‚æ•°æ˜¯ä»€ä¹ˆã€‚å®ƒè‡ªç„¶æ˜¯æœ‰åˆ©äºâ€œå°è£…â€çš„è¡Œä¸ºï¼Œä¸è¿‡æœ‰æ—¶åœ¨æˆ‘ä»¬éœ€è¦ *public* è¡Œä¸ºæ—¶ï¼Œå°±ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„äº†ã€‚

å¯¹æ­¤ï¼Œ *racket* è¿˜æœ‰ä¸¤ç§ç±»å‹çš„æ‰©å±•æœºåˆ¶ã€‚ *é€æ˜ç±»å‹ transparent* å’Œ *è™šæ‹Ÿç±»å‹ previously fabricated* ã€‚å‰è€…æ˜¯è§£å†³ *public* çš„ä¸€ç§è‡ªç„¶æƒ³æ³•ï¼Œåè€…å°±æœ‰ç‚¹å¤©é©¬è¡Œç©ºçš„æ„Ÿè§‰äº†ã€‚


```racket
(struct point (x y))

(define (get-point x y) 
    (struct point (x y) #:transparent)
    (point x y)
  )
(get-point 1 2)
```

å½“åœ¨ ``struct`` åé¢æ·»åŠ  ``#:transparent`` å…³é”®å­—åï¼Œè¿™ä¸ªç»“æ„å°±æ˜¯â€œé€æ˜ç±»å‹â€äº†ã€‚å¯¹äºé€æ˜ç±»å‹ï¼Œç°åœ¨èƒ½çœ‹åˆ°çš„åªæ˜¯æ‰“å°å‡ºæ¥çš„æ ·å­ï¼Œä» ``#<point>`` å˜æˆäº† ``(point 1 2)`` ï¼Œè‡³å°‘èƒ½çœ‹åˆ°æ„é€ æ—¶çš„å‚æ•°äº†ã€‚åé¢ï¼Œè¿˜æœ‰åå°„ç›¸å…³çš„æœºåˆ¶å¯ä»¥ä½œç”¨äºå®ƒã€‚

é’ˆå¯¹ä¸Šé¢çš„ä»£ç ï¼Œè¿˜å¯ä»¥äº†è§£åˆ°ï¼Œ ``struct`` å®šä¹‰ç»“æ„ï¼Œå¹¶ä¸æ˜¯å…¨å±€ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªè‡ªç„¶çš„ä½œç”¨åŸŸèŒƒå›´ï¼Œå¯ä»¥åœ¨å±€éƒ¨å†å®šä¹‰åŒåçš„ç»“æ„ã€‚

é™¤äº†â€œé€æ˜ç±»å‹â€ï¼Œè¿˜æœ‰ä¸€ä¸ª *è™šæ‹Ÿç±»å‹ previously fabricated* ï¼Œè¿™ä¸ªæœºåˆ¶ï¼Œç”šè‡³å¯ä»¥è®©æˆ‘ä»¬åœ¨ç»“æ„è¢«å®šä¹‰å‰ï¼Œå°±é¢„å…ˆå¼€å§‹ä½¿ç”¨è¿™ä¸ªç»“æ„äº†ï¼š

```racket
(define p #s(point 1 2))
```

è¿™ä¸ªåƒæ˜¯ä½¿ç”¨å‘é‡çš„è¯­å¥ï¼Œæ˜¯åˆæ³•çš„ã€‚å®ƒå®šä¹‰äº† ``p`` æ˜¯ä¸€ä¸ªåä¸º ``point`` çš„ç»“æ„çš„å®ä¾‹ã€‚ä½†æ˜¯è¿™ä¸ª ``point`` åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿç›®å‰ä¸ºæ­¢ï¼Œè¿™ä¸ª ``point`` ç¡®å®è¿˜ä¸å­˜åœ¨ã€‚

```racket
(define p #s(point 1 2))
(struct point (x y) #:prefab)
(point? p)
(point-x p)
```

å¯ä»¥åœ¨åé¢ä½¿ç”¨ ``struct`` å†åŠ ä¸Š ``#:prefab`` å†å®šä¹‰è¿™ä¸ªç»“æ„çš„å…·ä½“å½¢å¼ã€‚

å®ƒç›¸å¯¹äºå…¶å®ƒè¯­è¨€çš„ç¥å¥‡ä¹‹å¤„ï¼Œå°±æ˜¯å¯ä»¥æ‰‹å†™ ``#s(xxx 1 2)`` è¿™æ ·çš„è¿˜æ²¡æœ‰è¢«å®šä¹‰ä¸œè¥¿ï¼Œåœ¨è¯­æ³•ä¸Šæ˜¯åˆæ³•çš„ã€‚ *racket* / *scheme* è¿™æ ·çš„è¯­è¨€ï¼ŒçœŸæ˜¯æ— æ—¶ä¸åˆ»åœ¨å‘æˆ‘ä»¬ç¤ºæ„â€œå½¢å¼â€ä¸â€œé€»è¾‘â€ä¹‹é—´é‚£æ— æ‰€è°“èˆ¬å­˜åœ¨çš„ç•Œé™ã€‚



## æ›´å¤šçš„å‚æ•° ##

ç»“æ„å®šä¹‰ä¸­ï¼Œè¿˜å¯ä»¥åœ¨æœ«å°¾åŠ å…¥æ›´å¤šçš„å‚æ•°ã€‚è¿™äº›å‚æ•°ï¼Œä¸€éƒ¨åˆ†æ˜¯å±æ€§å®šä¹‰ï¼Œæ¯”å¦‚åƒ ``#:mutable`` ï¼Œå¦ä¸€éƒ¨åˆ†åƒæ˜¯ Python ä¸­çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå¦‚ ``__str__`` ï¼Œå®šä¹‰äº†ä¸€ä¸ªç»“æ„çš„è¡Œä¸ºè¡¨ç°ï¼Œå¦‚ ``custom-write`` ã€‚

``#:mutable`` ï¼Œç»“æ„çš„å±æ€§å¯å˜ ï¼š

```racket
(struct point (x y) #:mutable)
(define p (point 1 2))
(point-x p)
(set-point-x! p 10)
(point-x p)
```

``#:auto-value`` ï¼Œå®šä¹‰ä¸€ä¸ªè‡ªåŠ¨å€¼ï¼ˆä¸å…è®¸ä¼ å‚ï¼Œä½†æ˜¯å¯ä»¥è·å–å±æ€§å€¼ï¼‰ï¼š

```racket
(struct o ([x #:auto]) #:auto-value 1)
(struct point o ([y #:auto]) #:auto-value 2)
(define p (point))
(o-x p)
(point-y p)
```

èƒ½è¿‡å±‚å±‚åµŒå¥—ï¼Œæœ€ç»ˆå¯ä»¥å¾—åˆ°ä¸€ä¸ª 0 å‚æ•°å€¼çš„ç»“æ„ã€‚


``#:guard`` å‚æ•°é¢„å¤„ç†ï¼Œå­ç±»å‹ä¹Ÿä¼šè§¦å‘çˆ¶çº§ï¼Œä½†æ˜¯åªä¼šä¼ é€’æœ‰é™å‚æ•°ï¼š

```racket
(struct point (x y)
  #:transparent
  #:guard [lambda (x y type-name)
            (if (= x 0) (values x y)
              (values (* 2 x) (* 2 y)))])

(point 1 2)
(point 0 2)
```

åœ¨è¿™é‡Œï¼Œä¹Ÿå¯ä»¥å¯¹å‚æ•°ä½œæœ‰æ•ˆæ€§çš„åˆ¤æ–­ï¼Œè¿”å›é”™è¯¯ï¼Œ ``(error type-name "wrong")`` ã€‚


``#:methods`` ï¼Œä¸€äº›é€šç”¨æ¥å£ï¼Œåƒ Python çš„ç‰¹æ®Šæ–¹æ³•ï¼Œç±»ä¼¼æœ‰ ``__getitem__``  ä¹‹ç±»çš„ã€‚è¿™é‡Œåªæ¼”ç¤ºä¸€ä¸‹ ``custom-write`` ï¼š

```racket
(define (print-out ins port mode)
  [display port]
  [display mode]
  [display "hello"]
  [display "\n"]
)

(struct point (x y)
  #:methods
  gen:custom-write
  [(define write-proc print-out)]
)

(define p (point 1 2))
p
```

``gen:custom-write`` çš„æ¥å£ï¼Œä¼šè°ƒç”¨ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ *nowhere* ï¼Œä¸çŸ¥é“è¿™æ ·è®¾è®¡çš„åˆè¡·ã€‚


``#:property`` ï¼Œå’Œ ``#:methods`` ä¸€æ ·çš„ï¼Œæ¯”å¦‚ ``prop:procedure`` æ˜¯å®šä¹‰åƒ Python ä¸­çš„ ``__call__`` è¡Œä¸ºï¼Œå³å®ä¾‹å¯ä»¥å†æ¬¡è¢«â€œè°ƒç”¨â€ã€‚ ``#:property`` å’Œ ``#:methods`` çš„åŒºåˆ«ï¼Œæ„Ÿè§‰åè€…æ˜¯ä¸€ä¸ªæ¥å£èŒƒå›´ï¼Œåƒå‰é¢çš„ï¼Œä½ éœ€è¦å®šä¹‰ä¸€ä¸ª ``write-proc`` æ–¹æ³•ã€‚è€Œ ``#:property`` é‡Œå°±ç›´æ¥æ˜¯å…·ä½“çš„è¡Œä¸ºäº†ï¼Œåƒ ``prop:procedure`` ç›´æ¥ä¸€ä¸ªå‡½æ•°å°±è¡Œã€‚

```racket
(struct point (x y)
  #:property
  prop:procedure
  (lambda (self a b) (+ (point-x self) (point-y self) a b))
)

(define p (point 1 2))
(p 10 20)
```

``#:super`` ï¼Œè·Ÿå‰é¢çš„ ``æ‰©å±•`` æ˜¯ä¸€æ ·çš„èƒ½åŠ›ï¼Œæ¢äº†ä¸ªå†™æ³•ï¼š

```racket
(struct point (x y))
(struct point-3d (z) #:super struct:point)

(define p (point-3d 1 2 3))
(point-3d-x p)
```

è¿™é‡Œè¿˜æœ‰ä¸€ç‚¹ï¼Œ ``point`` å’Œ ``struct: point`` æ˜¯ä¸åŒçš„ä¸œè¥¿ã€‚ ``struct?`` å’Œ ``struct-type?`` ä¹Ÿæ˜¯ä¸åŒçš„ã€‚


# æ¨¡å— #

## åŸºæœ¬ç”¨æ³• ##

*racket* çš„æ¨¡å—æœºåˆ¶ï¼Œæœ¬èº«è¿˜æ˜¯æ¯”è¾ƒç›´è§‚çš„ï¼Œä½†æ˜¯ç»†èŠ‚çš„å˜åŒ–ä¸Šï¼Œåˆæå¾—å¾ˆå¤æ‚ã€‚å…‰æ˜¯ ``require`` çš„å½¢å¼ï¼Œå°±æœ‰ä¸‰ç§ï¼š

```racket
(require demo) ;ä»åŒ…ç®¡ç†ä¸­å¯¼å…¥
(require "demo.rkt") ;ä»ç›¸å¯¹è·¯å¾„ä¸­å¯¼å…¥
(require 'demo) ;å¯¼å…¥å½“å‰çš„ä¸€ä¸ª module å®šä¹‰
```

æ¨¡å—çš„ç»“æ„ï¼ŒåŸºæœ¬æ˜¯æŒ‰ç›®å½•ç»“æ„ï¼Œæ–‡ä»¶ä¸­è¦â€œå¯¼å‡ºâ€çš„æ–¹æ³•ï¼Œéœ€è¦é¢å¤–çš„ä½¿ç”¨ ``provide`` ï¼Œå‡è®¾æœ‰ä¸€ä¸ª ``demo.rkt`` æ˜¯ä¸‹é¢çš„å†…å®¹ï¼š

```racket
#lang racket  


(provide get-point point-x)

(struct point (x y) #:transparent)
(define (get-point x y) (point x y))

(module* main #f
  (get-point 1 2))
```

æœ€åçš„ ``module* main #f`` ç›¸å…³äº Python ä¸­çš„ ``if __name__ == '__main__'`` ã€‚ ``provide`` å¯¼å‡ºä¸­ï¼Œéœ€è¦åŒ…æ‹¬ç›¸å…³çš„å‡½æ•°ï¼Œå¦åˆ™ï¼Œ ``get-point`` å‡ºå»çš„ç»“æ„ï¼Œä¹Ÿæ²¡åŠæ³•è·å–ç›¸å…³æ•°æ®çš„ã€‚

åœ¨å¦ä¸€ä¸ª ``a.rkwt`` å½“ä¸­å¯¼å…¥ ``demo.rkt`` ï¼š

```racket
#lang racket

(require "demo.rkt")
(define p (get-point 1 2))
(point-x p)
#;(point-y p)
```

æ¨¡å—æœ¬èº«ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œå’Œæ–‡ä»¶æ²¡æœ‰å…³ç³»ã€‚æ–‡ä»¶ä¸Šçš„è¡¨ç°ï¼Œå·²ç»æ˜¯ä¸€ä¸ªåŠ å·¥äº†ã€‚

```racket
#lang racket  

(module demo (lib "racket/main.rkt")
  (display "in demo\n")
  (define (hello a) (display (string-join (list "Hello" a "\n"))))
  (provide hello))

(require 'demo)
(hello "world")
```

``lib`` å‡½æ•°åé¢è·Ÿå­—ç¬¦ä¸² ``"racket/main.rkt"``ï¼Œå°±ç›¸å…³äºç›´æ¥å†™ ``racket`` äº†ï¼Œè¡¨ç¤ºæ¨¡å—çš„ä½ç½®ã€‚è€Œè¿™é‡Œçš„ ``racket`` ï¼Œä¹Ÿå³ç›¸å½“äºä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŠŠå½“å‰æ–‡ä»¶ä½œä¸ºä¸€ä¸ª ``module`` å¿«æ·å®šä¹‰ï¼Œæœ€å¼€å¤´å†™çš„ ``#lang`` ï¼Œå°±æ˜¯ ``module`` å®Œæ•´å½¢å¼çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚



## æ¨¡å—ç›¸å…³è·¯å¾„ ##

é™¤äº†å½“å‰ä½ç½®çš„â€œç›¸å¯¹è·¯å¾„â€ï¼Œ *racket* ä¹Ÿæœ‰åŒ…å¯»æ‰¾è·¯å¾„å’Œå¯¹åº”çš„ç¯å¢ƒå˜é‡ã€‚

ç¯å¢ƒå˜é‡æ˜¯ *PLTCOLLECTS* ï¼Œå¯ä»¥æŒ‡å®šåŒ…å¯»æ‰¾çš„ä½ç½®ã€‚

é»˜è®¤çš„ä½ç½®ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ‰¾åˆ°ï¼š

```racket
(require setup/dirs)
(find-user-collects-dir)
(get-collects-search-dirs)
```


## å­æ¨¡å— ##

æ¨¡å—å½“ä¸­å†é€šè¿‡ ``module`` æˆ–è€… ``module*`` ï¼Œå£°æ˜çš„æ¨¡å—ï¼Œå°±æ˜¯å­æ¨¡å—ã€‚ *racket* ä¸­çš„å­æ¨¡å—å…·æœ‰å’Œæ™®é€šæ¨¡å—ä¸€æ ·çš„ç‹¬ç«‹æ€§ï¼Œå³ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œéƒ½ä¸ä¼šéšçˆ¶æ¨¡å—å¯¼å…¥å¯¼å‡ºï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ª ``demo.rkt`` æ–‡ä»¶ï¼š

```racket
#lang racket  

(module demo (lib "racket/main.rkt")
  (display "in demo\n")
  (define (hello a) (display (string-join (list "Hello" a "\n"))))
  (provide hello))
```

åœ¨åŒç›®å½•çš„å¦ä¸€ä¸ª ``a.rkt`` æ–‡ä»¶ä¸­ï¼Œå¦‚æœå†™æˆï¼š

```racket
#lang racket

(require "demo.rkt")
(hello "world")
```

æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º ``demo.rkt`` è¿™ä¸ªæ¨¡å—ï¼Œå¹¶æ²¡æœ‰ ``hello`` å‡½æ•°ï¼Œ ``hello`` æ˜¯åœ¨ ``demo.rkwt`` é‡Œé¢çš„å­æ¨¡å— ``demo`` é‡Œçš„ï¼Œè¦æ­£ç¡®å¼•å…¥ï¼Œéœ€è¦å†™æˆï¼š

```racket
(require (submod "demo.rkt" demo))
(hello "world")
```


å†çœ‹ ``module*`` çš„è¡Œä¸ºï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºå†…éƒ¨ä½¿ç”¨è€Œå®šä¹‰çš„å­æ¨¡å—ï¼š

```racket
#lang racket  

(module demo (lib "racket/main.rkt")
  (define (add1 a) (+ a 1))
  (module demo-sub racket
    [display "in demo\n"]
    [define (hello a) (display (string-join (list "Hello" a "\n")))]
    [provide add1]
    [provide hello]
))

(define (add a b) (+ a b))

(require (submod 'demo demo-sub))
(module* main #f 
  (hello "world")
  (add1 10)
  (add 1 2))
```

``module*`` åŠ ä¸Š ``#f`` å¯ä»¥ä½¿è¿™ä¸ªå­æ¨¡å—çœ‹åˆ°å½“å‰æ¨¡å—çš„æ‰€æœ‰ç»‘å®šã€‚

è¿˜æœ‰ä¸€ä¸ª ``module+`` çš„å½¢å¼ï¼Œç±»å‹ ``module*`` åŠ  ``#f`` ï¼Œä½†æ˜¯ ``module+`` å¯ä»¥å¤šæ¬¡å£°æ˜ä¸€ä¸ªåå­—çš„å­æ¨¡å—ï¼Œæœ€ç»ˆå®ƒä»¬ä¼šè‡ªåŠ¨åˆå¹¶ï¼š

```racket
(module+ main
  (add 1 2))

(module+ main
  (hello "world"))

(module+ main
  (hello "world2"))
```


# Contracts #

## æ˜¯ä»€ä¹ˆ ##

*Contracts* çš„ä½œç”¨ï¼Œæ˜¯â€œçº¦æŸâ€ï¼Œå®ƒæè¿°äº†åƒå‡½æ•°çš„å…¥å‚ä¸ç»“æœæ˜¯ä»€ä¹ˆæ ·å­ã€‚â€œç±»å‹â€åªæ˜¯â€œçº¦æŸâ€çš„å­é›†ã€‚æ¯”å¦‚ï¼Œå…¶å®ƒè¯­è¨€ä¸­çš„ç±»å‹ï¼Œå¯ä»¥æŒ‡å®šè¯´ï¼Œâ€œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•´æ•°â€ï¼Œä½†æ˜¯ *Contracts* å¯ä»¥åšåˆ°â€œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¤§äº 2 ä¸”å°äº 10 çš„æ•´æ•°â€ã€‚

æ›´ç¥å¥‡çš„æ˜¯ï¼Œåœ¨ *racket* ä¸­ï¼Œè¿™å¥— *Contracts* æœºåˆ¶ï¼Œå®Œå…¨æ˜¯å¯æ’æ‹”çš„ï¼Œå‰é¢ä»‹ç»çš„ä¸­ï¼Œå®Œå…¨ä¸ç®¡å®ƒï¼Œå®Œå…¨ä¸å½±å“ä»£ç å’ŒåŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨ã€‚è€Œä¸”ï¼Œå®ƒæ²¡æœ‰è‡ªå·±çš„â€œè¯­æ³•â€ï¼Œå®Œå…¨å’Œæ™®é€šä»£ç ä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯æ™®é€šä»£ç ã€‚

ç”¨æ™®é€šä»£ç å»çº¦æŸæ™®é€šä»£ç ã€‚

å…¶å®ƒè¯­è¨€ä¸­çš„ï¼Œæ¥å£ï¼Œæ³›å‹ï¼Œåœ¨ *racket* ä¸­æ²¡æœ‰ä»»ä½•ç‰¹æ®Šåœ°ï¼Œæ²¡æœ‰æ·»åŠ ä»»ä½•é¢å¤–è¯­æ³•åœ°ï¼Œå°±è¿™ä¹ˆå®ç°äº†ã€‚

*Contracts* çš„æ ·å­ï¼Œå¤§æ¦‚æ˜¯ï¼š

```racket
#lang racket  

(module demo racket
  (provide (contract-out [x positive?]))
  (define x 123))

(require 'demo)
x
```

``demo`` æ¨¡å—ä¸­ä¸Šï¼Œå£°æ˜äº†ä¸€ä¸ª *contract* ï¼Œè¯´ ``x`` éœ€è¦æ˜¯æ­£æ•°ã€‚è¿™æ—¶å¦‚æœå†™æˆ ``(define x -1)`` å°±ä¼šæŠ¥é”™äº†ã€‚




## ç»‘å®š ##

â€œç»‘å®šâ€å°±æ˜¯ ``define`` çš„é‚£äº›æ ‡è¯†ï¼Œå¯ä»¥ç»™å®ƒä»¬éƒ½æ·»åŠ ç›¸åº”çš„ *Contracts* ã€‚


```racket
#lang racket  

(define/contract
  x
  (or/c string? positive?)
  "hello")

(set! x -1) ;error
```

ä½¿ç”¨ ``define/contract`` åœ¨å®šä¹‰çš„åŒæ—¶ç»™å‡ºç›¸åº”çš„çº¦æŸã€‚

ä½¿ç”¨ ``or/c`` æˆ–è€… ``and/c`` å¯ä»¥ç»„ä»¶çº¦æŸçš„æ¡ä»¶ã€‚

å¦‚æœè¿‡ç¨‹ä¸­å‡ºç°äº†ä¸æ»¡è¶³ *Contracts* çš„æƒ…å†µï¼Œåˆ™ä¼šæŠ¥é”™ã€‚

## å‡½æ•° ##

### ä¸€èˆ¬å½¢å¼ ###

å‡½æ•°ä¸­ï¼Œæœ‰â€œå‚æ•°â€å’Œâ€œç»“æœâ€ï¼Œæ‰€ä»¥å‡½æ•°çš„ *Contracts* ä¹Ÿåº”è¯¥åŒ…å«è¿™ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œä½¿ç”¨ ``->`` å‡½æ•°è¡¨ç¤º ã€‚

```racket
(module demo racket
  (provide (contract-out
             [add (-> positive? number? number?)]))
  (define (add a b) (+ a b)))

(require 'demo)
(add -1 2)
```

ä¸Šé¢ï¼Œæè¿°äº† ``add`` å‡½æ•°çš„å‚æ•°ä¸­ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ­£æ•°ï¼Œæ‰€ä»¥ ``(add -1 2)`` ä¼šæŠ¥é”™ã€‚

``->`` ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å†™æˆ ``(positive? number? . -> . number?)`` æœ‰æ—¶ä¼šå¥½çœ‹ç‚¹ã€‚

å‡½æ•°ä¹Ÿå¯ä»¥åœ¨å®šä¹‰æ—¶ï¼Œç›´æ¥ç»™å‡ºçº¦æŸï¼š


```racket
(define/contract
  (add a b)
  (positive? number? . -> . number?)
  (+ a b))

(add 1 2)
(add -1 2)
```

### any any/c void? ###

- ``any`` ä»»ä½•ä¸œè¥¿ï¼Œç³»ç»Ÿéƒ½å¯ä»¥ä¸æ£€æŸ¥ã€‚
- ``void?`` ç©ºï¼Œæ¯”å¦‚æ²¡æœ‰è¿”å›ã€‚
- ``any/c`` ç±»å‹ ``any`` ï¼Œä½†æ˜¯å®ƒé™åˆ¶äº†ï¼Œåªæ˜¯èƒ½â€œå•å€¼â€ï¼Œä¸èƒ½æ˜¯â€œå¤šå€¼â€ã€‚


### é«˜é˜¶å‡½æ•° ###

åµŒå¥—ä½¿ç”¨ ``->`` å°±å¯ä»¥äº†ï¼š


```racket
(define/contract
  (base-add a)
  (number? . -> . (number? . -> . number?))
  (lambda (b) (+ a b)))

(define/contract
  (all-add func lst)
  (-> (-> number? number?) list? list?)
  (map func lst))

((base-add 10) 1)

(all-add (lambda (n) (+ n 1)) '(1 2 3))
```


### æç¤ºä¿¡æ¯ ###


```racket
(define/contract
  (add a b)
  (->
    (flat-named-contract
      'a
      (lambda (x) (and (> x 10) (< x 100)))
    )
    positive?
    positive?)
  (+ a b))

(add 1 -1)
```

åœ¨å¯¹åº”å‚æ•°/ç»“æœçš„ä½ç½®ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ ``flat-named-contract`` æ¥ç»™å‡ºå…·ä½“çš„æç¤ºï¼Œå¦åˆ™ï¼Œåƒ ``labmda`` è¿™ç§ï¼Œä¼šæ˜¾ç¤ºæˆä»£ç çš„ä½ç½®ã€‚


### å¯é€‰å‚æ•° ###

å¯é€‰å‚æ•°ï¼Œå°±æ˜¯å¸¦é»˜è®¤å€¼ï¼Œåœ¨å‚æ•°åˆ—è¡¨ååŠéƒ¨åˆ†çš„é‚£äº›å‚æ•°ã€‚è¿™ç§å½¢å¼ä¸‹ï¼Œéœ€è¦ä½¿ç”¨ ``->*`` æ¥åˆ¶å®šçº¦æŸã€‚ ``->*`` æœ‰ä¸¤éƒ¨åˆ†è¾“å…¥å‚æ•°ï¼Œç¬¬ä¸€ç»„æ˜¯å¿…é¡»å‚æ•°åˆ—è¡¨ï¼Œç¬¬äºŒç»„æ˜¯å¯é€‰å‚æ•°åˆ—è¡¨ã€‚

```racket
(define/contract
  (add a b [c 1] [d 1])
  (->* (number? number?)
       (number? number?)
       number?)
  (+ a b c d))

(add 1 1 3 3)
```


### ä¸å®šå‚æ•° ###

ä¸å®šå‚æ•°ï¼ŒæŒ‡å‚æ•°ä¸ªæ•°ä¸ç¡®å®šçš„æƒ…å†µã€‚

å®ƒåŒæ ·ä½¿ç”¨ ``->*`` ï¼Œä¸è¿‡éœ€è¦é…åˆä¸€ä¸ª ``#:rest`` å…³é”®è¯ã€‚

å‡½æ•°ä¸­å®šä¹‰ä¸å®šå‚æ•°ï¼Œæ˜¯ä½¿ç”¨çš„ ``.`` è¿™ä¸ªç¬¦å·æ¥åˆ†å‰²å‚æ•°ï¼š

```racket
(define
  (max-abs n . lst)
  (if (empty? lst) n
    [apply max-abs
           (max (abs n) (abs (first lst)))
           (rest lst)]))

(max-abs -10 -2 3 4)
```

åŠ ä¸Šçº¦æŸçš„è¯ï¼ˆä¼°è®¡åœ¨çº¦æŸä¸­åŠ ä¸€ä¸ªå€¼å¿…é¡»å¤§äº 0ï¼‰ï¼š

```racket
(define (list-and lst)
  (cond [(empty? lst) #t]
        [(eq? #f (first lst)) #f]
        [else (list-and (rest lst))]))

(define/contract
  (max-abs n . lst)
  (->* (number?)
       ()
       #:rest (lambda (lst) (list-and (map
                                        (lambda (x) (and (number? x) (> x 0)))
                                        lst)))
       ;#:rest (listof number?)
       number?)
  (if (empty? lst) n
    [apply max-abs
           (max (abs n) (abs (first lst)))
           (rest lst)]))

(max-abs 10 2 3 1)
```

``->*`` çš„å‚æ•°çš„å®Œæ•´å½¢å¼ï¼Œè¿˜å¯ä»¥å¤šä¸€ä¸ª ``#:rest`` ï¼Œåé¢æ˜¯ä¸€ä¸ªå‚æ•°æ˜¯åˆ—è¡¨çš„å‡½æ•°ã€‚

è¿™é‡Œ ``and`` æ˜¯ç‰¹æ®Šå‡½æ•°ï¼Œæ‰€ä»¥ ``(apply and ...)`` ä¼šæŠ¥é”™ã€‚


### å…³é”®è¯å‚æ•° ###


å…³é”®è¯å‚æ•°åœ¨çº¦æŸå®šä¹‰ä¸­ï¼Œä½¿ç”¨æ™®é€šçš„ ``->`` å°±å¯ä»¥äº†ï¼Œå®ƒæ”¯æŒå…³é”®è¯å‚æ•°ï¼š

```racket
(define/contract
  (minus a #:other b)
  (-> number? #:other number?
      number?)
  (- a b))

(minus #:other 10 1)
```

å…³é”®è¯å’Œå¯é€‰å‚æ•°ä¸€èµ·ï¼š

```racket
(define/contract
  (minus a #:other [b 10])
  (->* (number?)
       (#:other number?)
       number?)
  (- a b))

(minus 1 #:other 10)
```


### case-lambda ###

``case-lambda`` æ˜¯ä¸€ä¸ªæœ‰ç‚¹åƒæ¨¡å¼åŒ¹é…çš„åŠŸèƒ½ï¼Œçº¦æŸå®šä¹‰ä¸Šï¼Œå¯¹åº”ä½¿ç”¨ ``case->`` ã€‚

```racket
(define/contract
  add
  (case->
    (number? number? . -> . number?)
    (number? . -> . number?))
  (case-lambda
    [(a b) (+ a b)]
    [(a) (+ 100 a)]))

(add 1)
(add 1 2)
```

### ç»“æœä¸å‚æ•°æœ‰å…³è” ###

å¹¿ä¹‰åœ°è¯´ï¼Œè¿™ç§æƒ…å†µåº”è¯¥è¯´æˆâ€œå‚æ•°ä¸å‚æ•°ä¹‹é—´æœ‰ä¾èµ–ï¼Œæˆ–è€…ç»“æœä¸å‚æ•°ä¹‹é—´æœ‰ä¾èµ–â€ã€‚ååŠæ®µï¼Œå…¶å®æ˜¯ä¸€æ®µâ€œåºŸè¯â€ï¼Œå¯¹äºä¸€ä¸ªå‡½æ•°æ¥è¯´ï¼Œé™¤éæ˜¯ç‰¹åˆ«çš„åƒå¸¸æ•°å‡½æ•°ï¼Œå…¶å®ƒçš„å‡½æ•°ï¼ŒåŸºæœ¬ä¸Šç»“æœéƒ½ä¾èµ–äºå‚æ•°ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œè¯´çš„çº¦æŸä¸Šçš„æœºåˆ¶ï¼Œæ›´å¤šçš„æ˜¯åœ¨äºåœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬è‡ªå·±æƒ³æ€ä¹ˆå®šä¹‰è¿™ä¸ªçº¦æŸè€Œå·²ï¼Œçº¦æŸä¸æ˜¯æ£€æŸ¥å‡½æ•°å¯¹é”™ï¼Œè€Œæ˜¯ç«™åœ¨è°ƒç”¨è€…è§’åº¦ï¼Œé˜²èŒƒé”™è¯¯åœ°ä½¿ç”¨äº†ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé”™è¯¯çš„â€œåŠ æ³•â€ï¼Œåœ¨å®ƒçš„å®ç°ä¸Šï¼Œ ``1 + 1 = 3`` ï¼Œçº¦æŸä¸æ˜¯è€ƒè™‘ ``1 + 1`` çš„ç»“æœå¯¹ä¸å¯¹ï¼Œè€Œæ˜¯è€ƒè™‘è°ƒç”¨ ``wrong-add`` è¿™ä¸ªå‡½æ•°æ—¶ï¼Œå®ƒçš„ä¸¤ä¸ªå‚æ•°æ˜¯å¦ä¼ å¯¹äº†ï¼Œæœ‰æ—¶ï¼Œå®ƒç¡®å®ä¹Ÿæ˜¯è·Ÿä¸šåŠ¡æœ‰å…³çš„ã€‚

åŒæ ·ä¹Ÿæ˜¯åŠ æ³•ï¼Œ ``a + b`` ï¼Œå‡è®¾ï¼Œæˆ‘ä»¬æœŸæœ›çš„æ˜¯ ``b > a`` ï¼Œè¿™ç§çº¦æŸï¼Œéœ€è¦ä½¿ç”¨ ``->i`` ï¼ˆ ``i`` è¡¨ç¤ºâ€œindy dependentâ€ï¼‰ï¼š

```racket
(define/contract
  (add a b)
  (->i ([a number?]
        [b (a) (and/c number? (>/c a))])
        [result (a b) (>=/c (+ a b))])
  (+ a b))

(add 1 2)
```

``->i`` ï¼Œåé¢æœ‰ä¸¤ç»„å‚æ•°ï¼Œç¬¬ä¸€ç»„ï¼Œæ˜¯å‡½æ•°çš„å‚æ•°ï¼ŒæŒ‰é¡ºåºï¼Œåé¢çš„å¯ä»¥ä¾èµ–å‰é¢çš„ã€‚ç¬¬äºŒç»„ï¼Œæ˜¯ç»“æœï¼Œå¯ä»¥ä¾èµ–æ‰€æœ‰å‡½æ•°å‚æ•°ã€‚

è¿™é‡Œé‡æ—©ç”³ä¸€ä¸‹ ``and/c``, ``>/c`` è¿™ç±»å‡½æ•°ã€‚å®ƒä»¬éƒ½æ˜¯é«˜é˜¶å‡½æ•°ï¼Œæœ€åçš„ç»“æœï¼Œæ˜¯ä»…æ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚


### å¯å˜å€¼ ###

### å¤šå€¼è¿”å› ###

### ä¸å®šç»“æœ ###


## æ¨¡å— ##

## ç»“æ„ ##

## æŠ½è±¡ Contracts ##

## è‡ªå®šä¹‰ Contracts ##



